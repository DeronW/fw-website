{% extends 'eten_base.swig.html' %}

{% block content %}
<div class="partial-user-center-panel">
    <div class="p2p_con clearfix">
        {% include './eten/partial/user-center-panel.swig.html' %}
        {% block user_content %}{% endblock %}
    </div>
</div>
{% endblock %}
{% block js %}
<script>
    $(function(){
         $UserReady(function(is_login, user){
            if(!is_login) {
                window.location.href="https://passport.9888.cn/passport/login?sourceSite=jrgc&service=http://www.9888.cn/static/web/user-center/index.html"
            }
            else{
                // var API_PATH = document.getElementById('api-path').value;
                var API_PATH ='http://www.9888.cn';

                $.ajax({
                    type: "POST",
                    url: API_PATH + "/api/userState/v2/userState.json",
                    data: "",
                    success: function(data){//头像
                        if(data.data.orderUser.headurl!= null && data.data.orderUser.headurl!= ''){
                            $('.head-kuang').removeClass('moren').css("background","url("+data.data.orderUser.headurl+") no-repeat");
                        }
                        if((data.data.orderUser.headurl== null || data.data.orderUser.headurl== '')&&( data.data.orderUser.sex==1)){
                            $('.head-kuang').removeClass('moren').addClass('man')
                        }
                        if((data.data.orderUser.headurl== null || data.data.orderUser.headurl== '')&&(data.data.orderUser.sex==0)){
                            $('.head-kuang').removeClass('moren').addClass('woman')
                        }

                        if(data.data.open_name!=null && data.data.open_name!=''){//名字
                            $('.user-name').html(data.data.open_name);
                        }
                        else{
                            if(data.data.orderUser.realName!=null && data.data.orderUser.realName!=''){
                                $('.user-name').html(data.data.orderUser.realName);
                            }
                            else{
                                $('.user-name').html('&nbsp');
                            }
                        }

                        if(data.data.open_name == null || data.data.open_name=='') {//工厂码
                            $('.ws-code').find('span').html(data.data.orderUser.promotioncode);
                        }
                        else{
                            $('.ws-code').remove()
                        }

                        if(data.data.userLevel){
                            if(data.data.userLevel==1){//用户VIP等级
                                $('#VIP-SPAN').html('VIP');
                            }
                            else{
                                $('.vip-back-pc-l,.vip-back-pc-r,#VIP-SPAN').addClass('v');
                                $('#VIP-SPAN').html('VIP'+data.data.userLevel);//vip等级
                            }
                        }
                        $("#VIP-SPAN").click(function(){
                            window.location.href=API_PATH+"/user/level/userLevel.shtml";
                        });

                        //是否绑定开通存管和设置交易密码
                        if(data.data.orderUser.mobile!= null && data.data.orderUser.mobile!= ''){
                            $('#bind_mobile_img').html('已完成手机绑定'+data.data.orderUser.mobile.substring(0,3)+'****'+data.data.orderUser.mobile.substring(7,11)+'，<a href="/depository/account/changePhoneOld.shtml" class="bls">修改</a>。 <span></span>')
                        }
                        else{
                            $("#bind_mobile_img").remove()
                        }
                        
                        if((data.data.openAccountStatus!= null && data.data.openAccountStatus!= '') && (data.data.openAccountStatus == 2 || data.data.openAccountStatus == 3 || data.data.openAccountStatus == 4|| data.data.openAccountStatus == 5)){
                            $('#open_account_img').removeClass('not').addClass('yes');
                        }
                        else{
                            $('#open_account_img').html('').append('<span class="ywc wyc chg">为确保资金安全，请尽快开通存管账户，<a href="${ctx}/depository/openAccount/toOpenAccount.shtml" class="bls">立即开户</a>。<span></span></span>');
                        }

                        if((data.data.openAccountStatus!= null && data.data.openAccountStatus!= '') && (data.data.openAccountStatus == 5)){
                            $('#bind_card_img').removeClass('not').addClass('yes0');
                        }
                        else if((data.data.openAccountStatus!= null && data.data.openAccountStatus!= '') && (data.data.openAccountStatus == 4)){
                            $('#bind_card_img').removeClass('not').addClass('yes');
                        }
                        else{
                            $('#bind_card_img').html('').append('<span class="ywc ctg chg">为确保资金安全，请尽快设置交易密码，<a href="${ctx}/depository/openAccount/toTradePwd.shtml" class="bls">立即设置</a>。<span></span></span>');
                        }

                        //左侧栏显示
                        if(!data.data.is_companyagent){ $('#left5').show() }
                        if(data.data.borrowCount>0||data.subrogationCount>0||data.debtorsCount>0){
                            $('#left9').show()
                        }
                        if(data.data.borrowCount>0){ $('#left10').show() }
                        if(data.data.subrogationCount>0){ $('#left11').show() }
                        if(data.data.debtorsCount>0){  $('#left12').show() }

                        if((data.data.financialerStatus!=null && data.data.financialerStatus!='') && data.data.financialerStatus==3){  $('#left16').show() }
                    }
                });
            }
        })
    })
</script>
{% endblock %}
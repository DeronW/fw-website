{% extends 'keji-web.swig.html' %}

{% block content %}
<div class="partial-user-center-panel">
    <div class="ucp-left-nav-bg"></div>
    <div class="ucp-right-panel"> {% block user_content %}{% endblock %}</div>
    {% include 'partial/user-center-panel.swig.html' %}
</div>
{% endblock %}

{% block javascripts %}
<script>
    'use strict';
    (function ($, window, document, undefined) {
        var methods = {
            //头像
            head: function (arg) {
                var avatar = $(".ucp-avatar");
                avatar.find(".default").addClass("hide");
                if (!arg) {
                    avatar.find(".male").removeClass("hide")
                } else {
                    if (arg.headurl) {
                        avatar.find(".self-define").removeClass("hide").attr("src", arg.headurl)
                    } else {
                        arg.sex == 1 ?
                            avatar.find(".male").removeClass("hide") :
                            avatar.find(".female").removeClass("hide")
                    }
                }

            },
            //名字
            name: function (arg1, arg2) {
                $('.user-name').text(arg1.open_name || arg2.realName || '');
            },
            //工厂码
            wscode: function (code) {
                code ? $('.ws-code a').text(code) : $('.ws-code').remove()
            },
            //用户VIP等级
            level: function (level) {
                if (level > 1) {
                    $(".ucp-angle").addClass("vip");
                    $(".ucp-angle a").text('VIP' + (level - 1));
                }
            },
            //是否绑定开通存管和设置交易密码
            state: function (arg1, arg2) {

            },
            //左侧栏显示
            left: function (arg) {
                if (!arg.is_companyagent) {
                    $('#ucpLinkSymbol').removeClass('hide')
                }
                //合同管理
                if (arg.borrowCount > 0 || arg.subrogationCount > 0 || arg.debtorsCount > 0) {
                    $('#ucpLinkContract').removeClass('hide')
                    $('[data-line=true]').removeClass('hide')
                } else {
                    $('[data-line=true]').addClass('hide')
                }
                //我的借款
                //if (arg.borrowCount > 0) {
                $('#ucpLinkBorrow').removeClass('hide');
                // }
                //权益转让
                if (arg.subrogationCount > 0) {
                    $('#ucpLinkTransfer').removeClass('hide')
                }
                //我的担保
                if (arg.debtorsCount > 0) {
                    $('#ucpLinkGuarantee').removeClass('hide')
                }
            }
        };

        $UserReady(function (is_login, user) {
            if (!is_login) {
                // window.location.href = "http://passport.9888keji.com/passport/login?sourceSite=jrgc"
            } else {
                var a_douge = document.getElementById("_douge_mall");
                a_douge && a_douge.setAttribute("href","http://passport.9888keji.com/passport/login?sourceSite=dgsc&service=https://www.dougemall.com/");

                $.ajax({
                    url: "http://www.gongchangp2p.cn/api/userState/v2/userState.json",
                    jsonp: "callback",
                    xhrFields: { withCredentials: true },
                    dataType: "jsonp"
                }).done(function (data) {
                    var data = data.data, ou = data.orderUser;
                    window._data = data;
                    methods.head(ou);
                    methods.name(data, ou);
                    methods.wscode(data.open_name ? null : ou.promotioncode);
                    if (data.userLevel) methods.level(data.userLevel);
                    methods.state(data, ou);
                    methods.left(data);
                })
            }
        });

        $("#VIP-SPAN").click(function () {
            window.location.href = "/user/level/userLevel.shtml";
        });

        $(".ucp-link").each(function () {
            var e = $(this);
            if (location.pathname == e.attr('href')) e.addClass("focus");
        })

    })(jQuery, window, document);

</script>
{% block extra_js %}{% endblock %} {% endblock %}

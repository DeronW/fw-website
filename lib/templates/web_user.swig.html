{% extends 'web_base.swig.html' %}

{% block content %}
<div class="partial-user-center-panel">
    {% include './web/partial/user-center-panel.swig.html' %}
    {% block user_content %}{% endblock %}
</div>
{% endblock %}
{% block js %}
<script>
    'use strict';
    (function ($, window, document, undefined) {

        var methods = {
            //头像
            head: function (arg) {
                var avatar = $('.head-kuang').find('div').removeClass('moren');
                if (arg.headurl != null) {
                    avatar.css("background", "url(" + arg.headurl + ") no-repeat");
                } else {
                    avatar.addClass(arg.sex == 1 ? 'man' : 'woman')
                }
            },
            //名字
            name: function (arg1, arg2) {
                $('.user-name').html(arg1.open_name || arg2.realName || '&nbsp;');
            },
            //工厂码
            wscode: function (arg1, arg2) {
                if (arg1.open_name == null) {
                    $('.ws-code').find('span').html(arg2.promotioncode);
                } else {
                    $('.ws-code').remove()
                }
            },
            //用户VIP等级
            level: function (arg) {
                if (arg) {
                    if (arg == 1) {
                        $('#VIP-SPAN').html('VIP');
                    } else {
                        $('.vip-back-pc-l,.vip-back-pc-r,#VIP-SPAN').addClass('v');
                        $('#VIP-SPAN').html('VIP' + (arg - 1));//vip等级
                    }
                }
            },
            //是否绑定开通存管和设置交易密码
            state: function (arg1, arg2) {
                if (arg2.mobile != null) {
                    $('#bind_mobile_img').html('已完成手机绑定' + arg2.mobile.substring(0, 3) + '****' + arg2.mobile.substring(7, 11) + '，<a href="/depository/account/changePhoneOld.shtml" class="bls">修改</a>。 <span></span>')
                } else {
                    $("#bind_mobile_img").remove()
                }

                if ((arg1.openAccountStatus != null) && (arg1.openAccountStatus == 2 || arg1.openAccountStatus == 3 || arg1.openAccountStatus == 4 || arg1.openAccountStatus == 5)) {
                    $('#open_account_img').removeClass('not').addClass('yes');
                } else {
                    $('#open_account_img').html('').append('<span class="ywc wyc chg">为确保资金安全，请尽快开通存管账户，<a href="${ctx}/depository/openAccount/toOpenAccount.shtml" class="bls">立即开户</a>。<span></span></span>');
                }

                if ((arg1.openAccountStatus != null) && (arg1.openAccountStatus == 5)) {
                    $('#bind_card_img').removeClass('not').addClass('yes0');
                } else if ((arg1.openAccountStatus != null) && (arg1.openAccountStatus == 4)) {
                    $('#bind_card_img').removeClass('not').addClass('yes');
                } else {
                    $('#bind_card_img').html('').append('<span class="ywc ctg chg">为确保资金安全，请尽快设置交易密码，<a href="${ctx}/depository/openAccount/toTradePwd.shtml" class="bls">立即设置</a>。<span></span></span>');
                }
            },
            //左侧栏显示
            left: function (arg) {
                if (!arg.is_companyagent) {
                    $('#left5').show()
                }
                if (arg.borrowCount > 0 || arg.subrogationCount > 0 || arg.debtorsCount > 0) {
                    $('#left9').show()
                }
                if (arg.borrowCount > 0) {
                    $('#left10').show()
                }
                if (arg.subrogationCount > 0) {
                    $('#left11').show()
                }
                if (arg.debtorsCount > 0) {
                    $('#left12').show()
                }
                if ((arg.financialerStatus != null) && arg.financialerStatus == 3) {
                    $('#left16').show()
                }
            },
            //导航栏高亮切换
            active: function () {
                var url = location.href;
                var arr = url.split("/");
                var page = arr[arr.length - 2];
                var id = {
                        'user-invest': 2,
                        'payment-details': 3,
                        'capital-flow': 4,
                        'ws-code': 5,
                        'red-paper': 6,
                        'user-coupon': 7,
                        'work-point': 'Credit',
                        'work-bean': 8,
                        'contract-manage': 9,
                        'my-loan': 10,
                        'subrogation': 11,
                        'my-security': 12,
                        'account-setting': 13,
                        'bank-card': 14,
                        'user-messages': 15
                    }[page] || 1;
                $('#left' + id).addClass('active')
            }
        };

        $UserReady(function (is_login, user) {
            if (!is_login) {
//                window.location.href = "http://passport.9888.cn/passport/login?sourceSite=jrgc"
            } else {
                var API_PATH = document.getElementById('api-path').value;
                $.get(API_PATH + "/api/userState/v2/userState.json", null,
                    function (data) {
                        var data = data.data, ou = data.orderUser;
                        methods.head(ou);
                        methods.name(data, ou);
                        methods.wscode(data, ou);
                        methods.level(data.userLevel);
                        methods.state(data, ou);
                        methods.left(data);
                        methods.active()
                    }, 'json');
            }
        });

        $("#VIP-SPAN").click(function () {
            window.location.href = API_PATH + "/user/level/userLevel.shtml";
        });

    })(jQuery, window, document);
</script>
{% block extra_js %}{% endblock %}
{% endblock %}